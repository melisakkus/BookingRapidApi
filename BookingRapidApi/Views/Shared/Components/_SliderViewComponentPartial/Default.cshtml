@*_SliderViewComponentPartial*@

@*  @model FilterHotel.Data
 *@

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
@* <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
 *@

<br />
<section id="slider" data-aos="fade-up">
    <div class="container-fluid padding-side">
        <div class="d-flex rounded-5"
             style="background-image: url(/mellow-1.0.0/images/slider-image.jpg); background-size: cover; background-repeat: no-repeat; height: 85vh; background-position: center;">
            <div class="row align-items-center m-auto pt-5 px-4 px-lg-0">
                <div class="text-start col-md-6 col-lg-5 col-xl-6 offset-lg-1">
                    <h2 class="display-1 fw-normal">Hayalinizdeki konaklamayı kolayca bulun, güvenle rezerve edin</h2>
                    <a href="index.html" class="btn btn-arrow btn-primary mt-3">
                        <span>
                            Otelleri Keşfedin
                            <svg width="18" height="18">
                                <use xlink:href="#arrow-right"></use>
                            </svg>
                        </span>
                    </a>
                </div>
                <div class="col-md-6 col-lg-5 col-xl-4 mt-5 mt-md-0">

                    <form id="form" class="form-group flex-wrap bg-white p-5 rounded-4 ms-md-5">

                        <h3 class="display-5">Online Rezervasyon</h3>

                        <div class="col-lg-12 my-4 position-relative">
                            <label for="sehir" class="form-label text-uppercase">Şehİr</label>
                            <input type="text" id="cityName" class="form-control" placeholder="Şehir..." />
                        </div>

                        <div class="col-lg-12 my-4">
                            <label class="form-label text-uppercase">Giriş Tarihi</label>
                            <div id="select-arrival-date"></div>
                        </div>

                        <div class="col-lg-12 my-4">
                            <label class="form-label text-uppercase">Çıkış Tarİhİ</label>
                            <div id="select-departure-date"></div>
                        </div>

                        <div class="col-lg-12 my-4">
                            <label class="form-label text-uppercase">Oda Sayısı</label>
                            <input type="number" value="1" name="quantity" id="room" class="form-control text-black-50 ps-3">
                        </div>

                        <div class="col-lg-12 my-4">
                            <label class="form-label text-uppercase">Kİşİ Sayısı</label>
                            <input type="number" value="1" name="quantity" id="person" class="form-control text-black-50 ps-3">
                        </div>

                        <div class="d-grid">
                            <button id="getHotelsButton" class="btn btn-arrow btn-primary mt-3">
                                <span>
                                    Rezervasyon Oluştur
                                    <svg width="18" height="18">
                                        <use xlink:href="#arrow-right"></use>
                                    </svg>
                                </span>
                            </button>
                        </div>

                    </form>
                </div>
            </div>
        </div>
    </div>
</section>

<div id="resultArea" class="mt-3">
    <p id="statusMessage"></p>
    <div id="hotelListArea">
        <%-- Hotel results will be loaded here --%>
    </div>
</div>

<script>
    $(function () {
        $("#getHotelsButton").click(function (event) { 
            event.preventDefault(); 

            let cityName = $("#cityName").val();
            let arrivalDate = $("input[name='select-arrival-date_value']").val();
            let departureDate = $("input[name='select-departure-date_value']").val();
            let roomCount = $("#room").val();
            let personCount = $("#person").val();

            // Basic validation (optional but recommended)
            if (!cityName || !arrivalDate || !departureDate || !roomCount || !personCount) {
                $("#statusMessage").text("Lütfen tüm alanları doldurun.").css('color', 'red');
                $("#hotelListArea").empty(); // Clear previous results
                return; // Stop execution
            }

            // --- First AJAX Call: Get Destination ID ---

            $.ajax({
                url: "/UI/GetId/" + cityName,
                type: "GET",

                success: function (receivedDestId) {
                    $("#statusMessage").text("Destination ID alındı: " + receivedDestId + ". Oteller aranıyor...").css('color', 'blue');

                    // --- Second AJAX Call: Get Hotels (Nested Inside First Success) ---

                    $.ajax({
                        url: `/UI/GetFilterHotels/${receivedDestId}/${arrivalDate}/${departureDate}/${personCount}/${roomCount}`, // Corrected URL using template literals
                        type: "GET",

                        success: function (hotelData) {
                            console.log("Received hotel data from backend:", hotelData); 

                            $("#statusMessage").text("Oteller başarıyla alındı.").css('color', 'green');
                            $("#hotelListArea").empty(); // Clear previous list

                            if (hotelData && hotelData.length > 0) {
                                let hotelListHtml = "<ul>";

                                hotelData.forEach(function (hotel) {
                                    hotelListHtml += `<li class='list-group-item'>${hotel.property?.name || 'İsim Yok'} - ${hotel.address || 'Adres Yok'}</li>`;
                                });
                                hotelListHtml += "</ul>";
                                $("#hotelListArea").html(hotelListHtml);
                            } else {
                                $("#hotelListArea").html("<p>Belirtilen kriterlere uygun otel bulunamadı.</p>");
                            }

                        },
                        error: function (xhr, status, error) {
                            console.error("Otel alma hatası:", status, error, xhr.responseText);
                            $("#statusMessage").text("Oteller alınırken bir hata oluştu.").css('color', 'red');
                            $("#hotelListArea").html(`<p>Hata Detayı: ${xhr.responseText || error}</p>`);
                        }
                    });
                    // --- End of Second AJAX Call ---

                },

                error: function (xhr, status, error) {
                    console.error("Destination ID alma hatası:", status, error, xhr.responseText);
                    $("#statusMessage").text("Destination ID alınamadı. Şehir adını kontrol edin veya API hatası.").css('color', 'red');
                    $("#hotelListArea").empty(); // Clear area on error
                    $("#hotelListArea").html(`<p>${errorMessage}</p>`);
                }
            });
            // --- End of First AJAX Call ---
        });
    });
</script>